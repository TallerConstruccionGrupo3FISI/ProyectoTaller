<!DOCTYPE html>
<html lang="en">
<% include ./partials/headers %>
<body>
  <% include ./partials/navbar %>


  <div class="container" >
    <div class="row">
    <% include ./partials/dashboard %>
		<div class="col-md-9">
		    <div class="card">
		        <div class="card-body">
		            <div class="row">
		                <div class="col-md-12">
		                    <h4>Tu perfil</h4>
		                    <hr>
		                </div>
		            </div>
		            <div class="row">
		                <div class="col-md-12">
		                    <form id="myFormPUT">
                              <div class="form-group row">
                                <label for="username" class="col-4 col-form-label">Nombre de usuario</label>
                                <div class="col-8">
                                  <input id="username" name="username" placeholder="Username" class="form-control here" required="required" type="text">
                                </div>
                              </div>
                              <div class="form-group row">
                                <label for="name" class="col-4 col-form-label">Nombres</label>
                                <div class="col-8">
                                  <input id="name" name="nombres" placeholder="First Name" class="form-control here" type="text">
                                </div>
                              </div>
                              <div class="form-group row">
                                <label for="lastname" class="col-4 col-form-label">Apellidos</label>
                                <div class="col-8">
                                  <input id="lastname" name="apellidos" placeholder="Last Name" class="form-control here" type="text">
                                </div>
                              </div>
                              <div class="form-group row">
                                <label for="email" class="col-4 col-form-label">Correo electronico*</label>
                                <div class="col-8">
                                  <input id="email" name="email" placeholder="Email" class="form-control here" required="required" type="text">
                                </div>
                              </div>
                              <div class="form-group row">
                                <label for="telefono" class="col-4 col-form-label">Telefono</label>
                                <div class="col-8">
                                  <input id="telefono" name="telefono" placeholder="telefono" class="form-control here" type="text">
                                </div>
                              </div>
                              <div class="form-group row">
                                <label for="direccion" class="col-4 col-form-label">Direccion</label>
                                <div class="col-8">
                                  <input id="direccion" name="direccion" placeholder="direccion" class="form-control here" type="text">
                                </div>
                              </div>


                              <div class="form-group row">
                                <label for="publicinfo" class="col-4 col-form-label">Informacion adicional</label>
                                <div class="col-8">
                                  <textarea id="publicinfo" cols="40" rows="4" class="form-control"></textarea>
                                </div>
                              </div>
                            </form>
                            <div class="form-group row">
                              <div class="offset-4 col-8">
                                <button onclick="update();" class="btn btn-primary" >Actualizar mi perfil</button>
                              </div>
                            </div>
		                </div>
		            </div>

		        </div>
		    </div>
		</div>
	</div>
  </div>

<!--script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

<script  type="text/javascript">

function update(){
                console.log(formToJson());
                $.ajax({
                    method: 'PUT',
                    contentType: "application/json",
                    url: "/clientes/<%=locals.user.dni%>",
                    dataType: 'json',
                    data: formToJson(),
                    /*data: JSON.stringify({
                      "username": $("username").val(),
                      "nombres":$("name").val(),
                      "apellidos":$("lastname").val(),
                      "email":$("email").val(),
                      "telefono":$("telefono").val(),
                      "direccion":$("direccion").val(),
                    }),*/
                    success: function() {
                        alert('Actualizacion con exito');
                    },
                    error: function(a,b,c) {
                        console.log("XMLHttpRequest: " + a);
                        console.log("textStatus: " + b);
                        console.log("errorThrown: " + c);
                        alert("XMLHttpRequest : " + a + " textStatus : " + b + " errorThrown : " + c);
                    }
                });
            }

function formToJson(){
        var formElement = document.getElementById("myFormPUT"),
            inputElements = formElement.getElementsByTagName("input"),
            jsonObject = {};
        for(var i = 0; i < inputElements.length; i++){
            var inputElement = inputElements[i];
            jsonObject[inputElement.name] = inputElement.value;

        }
        return JSON.stringify(jsonObject);
    }

    $(document).ready(function () {
              var $nombres = $('#name');
              var $apellidos = $('#lastname');
              var $email = $('#email');
              var $direccion = $('#direccion');
              var $telefono = $('#telefono');
               $.ajax(
                 {
                   "type": "GET",
                   "url": "/clientes/<%=locals.user.dni%>",
                   "datatype": "json",
                   success: function(datas){
                            $.each(datas, function(i, data){
                              $nombres.val(data.nombres);
                              $apellidos.val(data.apellidos);
                              $email.val(data.email);
                              $direccion.val(data.direccion);
                              $telefono.val(data.telefono);
                            });
                   }
                });
    });




</script>

</body>
</html>
